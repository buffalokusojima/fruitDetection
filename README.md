# fruitDetection

# 課題について

各種フルーツの画像からその種類、品種を学習したモデルを作成し、それを用いてフルーツの種類、品種を判定する。

## 環境

Python

- Python 3.6.8

- モジュール: requirements.txtをインストール `pip install -r requirements.txt`

モデル

-

データ

-

## 課題実行方法

課題実行方法について記載する

詳細は課題実行フォルダ内のスクリプトに記載されている。
コマンドから実行する場合は以下を実行

`python detect.py ../../data/image_data ../../data/bbox_data.csv ../../data/label_info.csv ../../data/result`

jupyterファイルに各種操作が記載されているので見る際は、下記コマンドでwebサーバーを立てる

`jupyter notebook` \
`localhost:8080`にアクセスしてjupyterファイルを開く

### 概要

起動時に種類判別モデル、種類判別モデルのネットワーク展開を行う。
その後、対象のフォルダを読み込み、画像１枚ずつに対して種類判定を行い、出力された種類を
元に該当する品種モデルで判別を行いその結果を事務局が提示するラベルに照らし合わせてリストに格納する。
最終的にリストの内容をCSVファイルに書き出す。


## 学習運用方法

- 学習に必要なもの

  - 画像データファイル
  - 画像データに対するアノテーションファイル
  - 分類を行う為のクラスファイル
  - 学習を行う為のパラメータファイル
  - 学習に使用する初期モデルファイル

- 学習結果として残すもの

  - 学習する際に作成した学習リスト(どの画像を使用したかパスとアノテーションが記載されたファイル)
  - 学習の際に作成したクラスファイル(どういった分類を行ったか)
  - 学習した結果作成されたモデルファイル(複数)
  - 学習の推移が描かれた画像ファイル

- 運用方法

  学習スクリプトを起動することで基本的に自動的にアウトプットフォルダが作成されてそこに学習結果が作成される
  スクリプトを起動する際に変更する点としては以下

  - 学習データのパス(画像ファイルとアノテーションファイルが格納されたパス)
  - 学習結果パス(logs/モデル名/データの種類(使用するデータのパスの名前など))

  この際、作成されるクラスファイルは学習データのパス直下にあるフォルダの名前になる。

  (例)種類モデルの場合

      学習データのパスが"学習データ/479削除データ(アノテーションテスト・keras-yolo3)/種類/image"の場合

      このフォルダ構成は以下のようになっている

      image ----------1_リンゴ
             |
                 |----2_梨


      annotation -----1_リンゴ
                  |
                  |---2_梨

      よって、image直下のリンゴ、梨、、、がクラスとなったクラスファイルが作成される。

    
    
  ※学習の処理がサーバリソースに多大なる影響を及ぼす為、本環境で学習は行わない。\
  あくまで今後の知見等に活かすため運用方法を記載したまでである。\
  学習は個々端末で実施(GPU推奨)
  
  
### 使用するスクリプト
programフォルダ内の学習フォルダ内にあるスクリプトを実行することで上記で説明した用に動作する。
また、このスクリプトを動作するに当たって必要なインプットとしては学習リストのパスをまとめたファイルが
必要となる。詳細はスクリプトを参照であるが、動作としては読み込んだ学習リストから種類か品種を判断し、
アウトプットとなるフォルダ作成や必要なクラスファイル取得等を行い、ファイルの行数分学習を行う。


## テスト運用方法

- テストに必要なもの

  - 学習済のモデルファイル
  - モデルに対するクラスファイル
  - 学習を行う為のパラメータファイル
  - テストする画像パスが記載されたテストファイル

- テストの結果として残すもの

  - 使用したモデルファイル
  - 使用したテストファイル
  - 正答率等をまとめたファイル
  - 正誤表
  - 不正解だった画像とそのアノテーションファイル
  - スクリプト自体をhtmlファイルにしたファイル

- 運用方法

  学習済のモデルファイルパスを元にアウトプットパスが生成される。

  前提として使用されるテストデータは事務局が用意したデータから種類ごとに100枚、
  品種ごとに30枚ずつ抽出したものである。
  学習に使用したデータはネットから独自に収集したものであり、いくつかはテストデータに
  存在するものであるが、基本的に未知のデータとして扱う。

  テストファイルには学習時と同様に画像パス以外に、アノテーションとクラス情報が格納されている。
  よって、テストの観点としては、画像認識をした際に出力されるアノテーションと、テストファイルに
  記載されているアノテーションを比較し、認識したアノテーションの中で最も近いもののクラスを認識結果とし、
  テストファイルに記載されているクラスと比較し、正答率を得る。

  対象のスクリプトはテストにあるテストレポート実行である。
  アノテーション認識について記載されてるスクリプトとしてはモデル精度検査_v3.htmlがある。

- テストデータ作成

  - 画像データから種類と品種に関して③で示した数の画像をランダムに取得し、新たにテストデータとしてコピーする(テストデータ作成スクリプト各種)
 
  - 新たに作成したテストフォルダに関して、情報を１つにまとめたテストファイルを作成する(テストリスト作成スクリプト)
